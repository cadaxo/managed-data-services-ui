<mvc:View controllerName="com.cadaxo.cmds.controller.App"
    xmlns:mvc="sap.ui.core.mvc" xmlns:core="sap.ui.core" xmlns="sap.m" 
	xmlns:layout="sap.suite.ui.commons.networkgraph.layout" xmlns:l="sap.ui.layout" xmlns:g="sap.suite.ui.commons.networkgraph">
	<Shell id="shell" appWidthLimited="false">
		<App id="app">
			<pages>
				<Page id="page" title="{i18n>title}">
					<customHeader>
						<Bar>
							<contentLeft>
								<Image height="40px" src="{imageModel>/cadaxoLogo}"></Image>
								<Text class="cadaxoHeaderText" text = "{i18n>headerText}"></Text>
							</contentLeft>
						</Bar>	
					</customHeader>
					<content>
						<FlexBox fitContainer="true" renderType="Bare" wrap="Wrap" id="graphWrapper">
						
							<g:Graph enableWheelZoom="false"
								enableZoom="true"
								nodes="{graphModel>/nodes}"
								id="graph"
								lines="{graphModel>/links}"
								noDataText="{i18n>noData}"
								width="auto"
								orientation="LeftRight"
								statuses="{graphModel>/statuses}">
								<g:layoutAlgorithm>
									<layout:ForceDirectedLayout
										optimalDistanceConstant="0.26"
										>
									</layout:ForceDirectedLayout>
								</g:layoutAlgorithm>
								<g:statuses>
									<g:Status key="{graphModel>StatusKey}"
									title="{graphModel>Description}"
									backgroundColor="{graphModel>Color2}"
									contentColor="{graphModel>Color1}">
									</g:Status>
								</g:statuses>
								<g:nodes>
									<g:Node key="{graphModel>DsId}" title="{graphModel>ObjectName}"
										icon="{
												path: 'graphModel>ObjectType',
												formatter: '.formatter.setNodeIcon'
										}"  
										showActionLinksButton="false"
										showDetailButton="false"
										showExpandButton="false"
										shape="Circle"
										width="300"
										status="{parts: [
											'graphModel>ObjectType', 'graphModel>ObjectState'
											],
											formatter: '.formatter.setNodeStatus'
										}"
										press="onNodePressed">
										<g:actionButtons>
												<g:ActionButton
													id="expand-action-button"
													title='Expand'
													icon='sap-icon://expand'
													press="getTablesPressed"/>
										</g:actionButtons>
										<!--g:actionButtons>
											<g:ActionButton
													icon="sap-icon://navigation-left-arrow"
													title="{i18n>showParentNodes}"
													position="Left"
													press="leftExpandPressed"/>
											<g:ActionButton
													icon="sap-icon://navigation-right-arrow"
													title="{i18n>showChildNodes}"
													press="rightExpandPressed"/>
											<g:ActionButton
												icon="sap-icon://open-command-field"
												title="Expand All"
												press="rightMultiExpandPressed"/>	
											<g:ActionButton
													icon="sap-icon://close-command-field"
													title="Expand All"
													position="Left"
													press="leftMultiExpandPressed"/>		
										</g:actionButtons-->
									</g:Node>

								</g:nodes>
								<g:lines>
								<g:Line 
									from="{graphModel>ObjectId1}" 
									to="{graphModel>ObjectId2}"
									press="linePressed"
									status="{parts: [
											'graphModel>Type'
											],
											formatter: '.formatter.setLineStatus'
										}"
									title="{graphModel>Description}"
									arrowOrientation="None">
								</g:Line>
							</g:lines>
						
							</g:Graph>
							<Panel visible="false" width="40%" height="100%" id="sideBar-panel">
								<headerToolbar>
									<OverflowToolbar>
										<Title text="{ObjectName}"/>
										<Title text="- {Description}"/>
										<ToolbarSpacer />
										
										<!--Button press="whereUsedPressed" id="btn-show-where-used" text="{i18n>showWhereUsed}" enabled="false" /-->
										<Button press="viewInBrowserPressed" icon="sap-icon://detail-view" tooltip="{i18n>showSourceCode}" enabled="{=${ActionLink/Display}.length !== 0}">
											<customData>
												<core:CustomData key="url" value="{ActionLink/Display}"/>
											</customData>
										</Button>
										<Button press="viewInAdtPressed" icon="sap-icon://edit-outside" tooltip="{i18n>showSourceCodeAdt}" enabled="{=${ActionLink/Edit}.length !== 0}">
											<customData>
												<core:CustomData key="url" value="{ActionLink/Edit}"/>
											</customData>										
										</Button>
										<Button press="hideSidebarPressed" icon="sap-icon://navigation-right-arrow" tooltip="{i18n>closeSidebar}" enabled="true">									
										</Button>
									</OverflowToolbar>
								</headerToolbar>
								<infoToolbar>
									<OverflowToolbar id="toolbar" active="false" design="Info" height="2rem" press="onToolbarPress"  ariaLabelledBy="myText">
										<Text id="myText" text="Mode: Show CDS View Sources"/>
										<ToolbarSpacer/>
										<!--core:Icon src="sap-icon://undo" width="2rem" press="onIconPress"/-->
									</OverflowToolbar>
								</infoToolbar>
								<content>
									<OverflowToolbar id="toolbar-buttons">
										<Button icon="sap-icon://hint" type="Transparent" press="handlePopoverPress" />
										<Button tooltip="Display Field Source for selected Field"  type="Transparent" press="getFieldSourcePressed" id="btn-show-where-used" text="Path To DB  / Display Field Source" enabled="false" />
										<Button tooltip="Display Field Target for selected Field"  type="Transparent" press="get3MoreFields" id="btn-show-target" text="Path To UI / Display Field Target" enabled="false" />
										<!--Button type="Transparent" press="getFieldSourcePressed" id="btn-show-full-mode" text="Switch to Freestyle Mode" enabled="true" />
										<Button type="Transparent" press="getFieldSourcePressed" id="btn-show-full-mode2" text="Button 3" enabled="false" />
										<Button type="Transparent" press="getFieldSourcePressed" id="btn-show-full-mode3" text="Button 4" enabled="false" />
										<Button type="Transparent" press="getFieldSourcePressed" id="btn-show-full-mode5" text="Button 5" enabled="false" />
										<Button type="Transparent" press="getFieldSourcePressed" id="btn-show-full-mode6" text="Button 6" enabled="false" />
										<Button type="Transparent" press="getFieldSourcePressed" id="btn-show-full-mode7" text="Button 7" enabled="false" /-->
										<ToolbarSpacer/>
									</OverflowToolbar>
									<TabContainer id="tabs" itemSelect="tabChanged">
										<items>
											<TabContainerItem name="{i18n>fields}">
												<content>
													<FlexBox id="fields-header">
														<items>
															<Text id="fields-header-column1" width="170px" text="{i18n>column}">
															<layoutData>
																<FlexItemData growFactor="1" />
															</layoutData>
															</Text>
															<Text id="fields-header-column2" width="145px" text="{i18n>dataElement}">
															<layoutData>
																<FlexItemData growFactor="1" />
															</layoutData>
															</Text>
															<Text id="fields-header-column3" width="100px" text="{i18n>dataType}">
															<layoutData>
																<FlexItemData growFactor="1" />
															</layoutData>
															</Text>
															<Text id="fields-header-column4" width="150px" text="{i18n>description}">
															<layoutData>
																<FlexItemData growFactor="1" />
															</layoutData>
															</Text>
														</items>
													</FlexBox>
													<Tree itemPress="fieldPressed" id="tree-fields" items="{nodeDetail>/fields}"
													mode="SingleSelectMaster"
													>
														<CustomTreeItem type="Active">
															<customData>
																<core:CustomData key="fieldName" value="{nodeDetail>text}"/>
															</customData>
															<FlexBox alignItems="Start" width="100%">
																<items>
																	<core:Icon class="cadaxoCustomIcon" src="sap-icon://key" size="1rem" visible="{= ${nodeDetail>isKey} === true }" 
																	tooltip="{i18n>primaryKey}" />
																	<Text width="150px" text="{parts: [
																		'nodeDetail>text', 'nodeDetail>isWhereUsed'
																		], formatter:'externFormatter.setHighlighted'}">
																	<layoutData>
																		<FlexItemData growFactor="1" />
																	</layoutData>
																	</Text>
																	
																	<Text visible="{= ${nodeDetail>isField} === true }" width="145px" text="{nodeDetail>dataelement}">
																	<layoutData>
																		<FlexItemData growFactor="1" />
																	</layoutData>
																	</Text>				
																	<Text visible="{= ${nodeDetail>isField} === true }" width="90px" text="{nodeDetail>datatype}">
																	<layoutData>
																		<FlexItemData growFactor="1" />
																	</layoutData>
																	</Text>																														
																	<Text visible="{= ${nodeDetail>isField} === true }" width="150px" text="{nodeDetail>description}">
																	<layoutData>
																		<FlexItemData growFactor="1" />
																	</layoutData>
																	</Text>	
																	<Text visible="{= ${nodeDetail>isField} === false }" width="100%" textAlign="Begin" text="{nodeDetail>value}" >
																	<layoutData>
																		<FlexItemData growFactor="1" />
																	</layoutData>
																	</Text>
																</items>
															</FlexBox>
														</CustomTreeItem>
													</Tree>
												</content>
											</TabContainerItem>
											<TabContainerItem name="{i18n>headerAnnotations}">
												<content>
													<Table id="headerAnnotations"
														inset="false"
														items="{nodeDetail>/headerAnnotations}">
														<columns>
															<Column width="70%">
																<Text text="{i18n>name}" />
															</Column>
															<Column width="30%">
																<Text text="{i18n>value}" />
															</Column>
														</columns>
														<items>
															<ColumnListItem>
																<cells>
																	<Text text="{nodeDetail>text}"/>
																	<Text text="{nodeDetail>value}" />
																</cells>
															</ColumnListItem>
														</items>
													</Table>
												</content>
											</TabContainerItem>
											<TabContainerItem name="{i18n>parameters}">
												<content>
														<Table id="parameters"
															inset="false"
															items="{
																path: 'nodeDetail>/parameters',
																sorter: {
																	path: 'Position'
																}
															}">
															<columns>
																<Column width="60%">
																	<Text text="{i18n>parameter}" />
																</Column>
																<Column width="20%">
																	<Text text="{i18n>dataElement}" />
																</Column>
																<Column width="20%">
																	<Text text="{i18n>dataType}" />
																</Column>
															</columns>
															<items>
																<ColumnListItem>
																	<cells>
																		<Text text="{nodeDetail>Description}"/>
																		<Text text="{nodeDetail>DataElement}"/>
																		<Text text="{nodeDetail>Datatype}" />
																	</cells>
																</ColumnListItem>
															</items>
														</Table>
												</content>
											</TabContainerItem>
										</items>
									</TabContainer>
								</content>
						
							</Panel>
						</FlexBox>
          			</content>
					<!--footer>
						<OverflowToolbar>
							<Button id="messagePopoverBtn"
								icon="{ path: 'messagePopoverModel>/', formatter: '.formatter.buttonIconFormatter' }"
								type="{ path: 'messagePopoverModel>/', formatter: '.formatter.buttonTypeFormatter' }"
								text= "{path: 'messagePopoverModel>/', formatter: '.formatter.highestSeverityMessages' }"
								press="handleMessagePopoverPress"
								/>
							<ToolbarSpacer/>
							<Text text="System: CC0, User: cadaxo" />
						</OverflowToolbar>
					</footer-->
				</Page>
			</pages>
		</App>
	</Shell>
</mvc:View>